{
  "version": 3,
  "sources": ["src/app/services/auth.service.spec.ts"],
  "sourcesContent": ["import { TestBed } from '@angular/core/testing';\nimport { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';\nimport { AuthService } from './auth.service';\nimport { User } from '../models/user.model';\nimport { of } from 'rxjs';\n\ndescribe('AuthService', () => {\n  let service: AuthService;\n  let httpMock: HttpTestingController;\n\n  const mockUser: User = {\n    id: 1,\n    email: 'test@example.com',\n    username: 'testuser',\n    avatarUrl: undefined,\n    provider: 'local',\n    roles: ['USER']\n  };\n\n  const mockAuthResponse = {\n    token: 'jwt-token',\n    user: mockUser\n  };\n\n  beforeEach(() => {\n    TestBed.configureTestingModule({\n      imports: [HttpClientTestingModule],\n      providers: [AuthService]\n    });\n    service = TestBed.inject(AuthService);\n    httpMock = TestBed.inject(HttpTestingController);\n  });\n\n  afterEach(() => {\n    httpMock.verify();\n    localStorage.clear();\n  });\n\n  it('should be created', () => {\n    expect(service).toBeTruthy();\n  });\n\n  // Note: register method not implemented in current AuthService\n  // This service uses OAuth2 authentication only\n\n  describe('login', () => {\n    it('should redirect to OAuth provider', () => {\n      // Mock window.location.href using Object.defineProperty\n      const mockLocation = { href: '' };\n      const originalLocation = window.location;\n      \n      Object.defineProperty(window, 'location', {\n        value: mockLocation,\n        writable: true,\n        configurable: true\n      });\n\n      service.login('google');\n\n      expect(mockLocation.href).toBe('http://localhost:8080/oauth2/authorization/google');\n      \n      // Restore original location\n      Object.defineProperty(window, 'location', {\n        value: originalLocation,\n        writable: true,\n        configurable: true\n      });\n    });\n\n    it('should handle invalid provider', () => {\n      spyOn(console, 'error');\n      \n      service.login('invalid' as any);\n      \n      expect(console.error).toHaveBeenCalledWith('Invalid OAuth provider:', 'invalid');\n    });\n  });\n\n  describe('logout', () => {\n    it('should clear token and call logout endpoint', () => {\n      // Set token using the service's private method\n      (service as any).authToken = 'jwt-token';\n\n      service.logout().subscribe(response => {\n        expect(response).toBeDefined();\n        expect((service as any).authToken).toBeNull();\n      });\n\n      const req = httpMock.expectOne('http://localhost:8080/api/auth/logout');\n      expect(req.request.method).toBe('POST');\n      expect(req.request.headers.get('Authorization')).toBe('Bearer jwt-token');\n      req.flush({ message: 'Logged out successfully' });\n    });\n\n    it('should clear token even if logout endpoint fails', () => {\n      (service as any).authToken = 'jwt-token';\n\n      service.logout().subscribe(response => {\n        expect(response).toBeDefined();\n        expect((service as any).authToken).toBeNull();\n      });\n\n      const req = httpMock.expectOne('http://localhost:8080/api/auth/logout');\n      req.flush('Server error', { status: 500, statusText: 'Internal Server Error' });\n    });\n  });\n\n  describe('getCurrentUser', () => {\n    it('should return current user when token exists', () => {\n      (service as any).authToken = 'jwt-token';\n\n      service.getCurrentUser().subscribe(user => {\n        expect(user).toEqual(mockUser);\n      });\n\n      const req = httpMock.expectOne('http://localhost:8080/api/auth/me');\n      expect(req.request.method).toBe('GET');\n      expect(req.request.headers.get('Authorization')).toBe('Bearer jwt-token');\n      req.flush(mockUser);\n    });\n\n    it('should return null when no token exists', () => {\n      (service as any).authToken = null;\n\n      service.getCurrentUser().subscribe(user => {\n        expect(user).toBeNull();\n      });\n\n      httpMock.expectNone('http://localhost:8080/api/auth/me');\n    });\n\n    it('should handle getCurrentUser error', () => {\n      (service as any).authToken = 'jwt-token';\n\n      service.getCurrentUser().subscribe(user => {\n        expect(user).toBeNull();\n      });\n\n      const req = httpMock.expectOne('http://localhost:8080/api/auth/me');\n      req.error(new ErrorEvent('Network error'), { status: 401, statusText: 'Unauthorized' });\n    });\n  });\n\n  describe('getToken', () => {\n    it('should return token from memory', () => {\n      (service as any).authToken = 'jwt-token';\n      expect(service.getToken()).toBe('jwt-token');\n    });\n\n    it('should return null when no token exists', () => {\n      (service as any).authToken = null;\n      expect(service.getToken()).toBeNull();\n    });\n  });\n\n  describe('isAuthenticated', () => {\n    it('should return true when token exists', () => {\n      (service as any).authToken = 'jwt-token';\n      expect(service.isAuthenticated()).toBe(true);\n    });\n\n    it('should return false when no token exists', () => {\n      (service as any).authToken = null;\n      expect(service.isAuthenticated()).toBe(false);\n    });\n  });\n\n  describe('handleAuthCallback', () => {\n    it('should handle auth callback with valid token', () => {\n      // Mock the getTokenFromCookie method to return a token\n      spyOn(service as any, 'getTokenFromCookie').and.returnValue('jwt-token');\n      (service as any).authToken = 'jwt-token';\n      \n      service.handleAuthCallback();\n\n      const req = httpMock.expectOne('http://localhost:8080/api/auth/me');\n      expect(req.request.method).toBe('GET');\n      req.flush(mockUser);\n    });\n\n    it('should handle auth callback and logout on error', () => {\n      spyOn(service as any, 'getTokenFromCookie').and.returnValue('invalid-token');\n      (service as any).authToken = 'invalid-token';\n      const logoutSpy = spyOn(service, 'logout').and.returnValue(of({ message: 'Logged out' }));\n      \n      service.handleAuthCallback();\n      \n      const req = httpMock.expectOne('http://localhost:8080/api/auth/me');\n      req.error(new ErrorEvent('Network error'));\n      \n      // Wait for async operation to complete\n      setTimeout(() => {\n        expect(logoutSpy).toHaveBeenCalled();\n      }, 0);\n    });\n  });\n});"],
  "mappings": "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",
  "names": ["init_testing"]
}
