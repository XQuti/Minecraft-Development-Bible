import{a as k,b as N,c as R,d as L,e as j,f as $,g as z,i as U,j as W}from"./chunk-JRH75BT2.js";import{a as H}from"./chunk-7XMZ43RN.js";import{A as p,D as l,H as t,I as r,J as g,K as S,L as C,M as m,N as _,O as a,P as c,Q as f,R as I,S as T,T as E,Y as P,da as F,ea as M,fa as V,h as x,i as v,ma as O,pa as D,q as y,r as b,ra as A,t as o,v as u,w}from"./chunk-MRSHGPQQ.js";import"./chunk-3YTOVYWG.js";function B(i,n){if(i&1&&(t(0,"div",15)(1,"h1",16),a(2),r(),t(3,"div",17)(4,"div",18),g(5,"img",19),t(6,"span",20),a(7),r()(),t(8,"span"),a(9,"\u2022"),r(),t(10,"span"),a(11),r(),t(12,"span"),a(13,"\u2022"),r(),t(14,"span"),a(15),r()()()),i&2){let e=m(2);o(2),c(e.thread.title),o(3),l("src",e.thread.author.avatarUrl||"/assets/default-avatar.png",b)("alt",e.thread.author.username),o(2),c(e.thread.author.username),o(4),c(e.formatDate(e.thread.createdAt)),o(4),f("",e.posts.length," replies")}}function G(i,n){i&1&&(t(0,"span",34),a(1,"OP"),r())}function J(i,n){if(i&1&&(t(0,"div",21)(1,"div",22)(2,"div",23),g(3,"img",24),t(4,"div",25)(5,"div",26)(6,"div",27)(7,"span",28),a(8),r(),t(9,"span",29),a(10),r(),p(11,G,2,0,"span",30),r(),t(12,"span",31),a(13),r()(),t(14,"div",32),g(15,"div",33),r()()()()()),i&2){let e=n.$implicit,s=n.index,d=m(2);o(3),l("src",e.author.avatarUrl||"/assets/default-avatar.png",b)("alt",e.author.username),o(5),c(e.author.username),o(2),c(d.formatDate(e.createdAt)),o(),l("ngIf",s===0),o(2),f("#",s+1,""),o(2),l("innerHTML",d.getFormattedContent(e.content),y)}}function Y(i,n){if(i&1){let e=S();t(0,"div",35)(1,"h3",36),a(2,"Post a Reply"),r(),t(3,"form",37,1),C("ngSubmit",function(){x(e);let d=m(2);return v(d.createPost())}),t(5,"div",38)(6,"textarea",39),E("ngModelChange",function(d){x(e);let h=m(2);return T(h.newPost.content,d)||(h.newPost.content=d),v(d)}),r()(),t(7,"div",40)(8,"button",41),a(9),r()()()()}if(i&2){let e=_(4),s=m(2);o(6),I("ngModel",s.newPost.content),o(2),l("disabled",!e.valid||s.posting),o(),f(" ",s.posting?"Posting...":"Post Reply"," ")}}function K(i,n){i&1&&(t(0,"div",42)(1,"p",43),a(2,"You need to be logged in to reply to this thread."),r(),t(3,"a",44),a(4," Login to Reply "),r()())}function Q(i,n){if(i&1&&(t(0,"div",4)(1,"div",5)(2,"nav",6)(3,"ol",7)(4,"li")(5,"a",8),a(6,"Forums"),r()(),t(7,"li"),a(8,"/"),r(),t(9,"li",9),a(10),r()()(),p(11,B,16,6,"div",10),t(12,"div",11),p(13,J,16,7,"div",12),r(),p(14,Y,10,3,"div",13)(15,K,5,0,"div",14),r()()),i&2){let e=m();o(10),c(e.thread==null?null:e.thread.title),o(),l("ngIf",e.thread),o(2),l("ngForOf",e.posts),o(),l("ngIf",e.authService.isAuthenticated()),o(),l("ngIf",!e.authService.isAuthenticated())}}function X(i,n){i&1&&(t(0,"div",45),g(1,"div",46),r())}function Z(i,n){if(i&1&&(t(0,"div",4)(1,"div",5)(2,"div",47)(3,"p",48),a(4),r()()()()),i&2){let e=m();o(4),c(e.error)}}var q=class i{constructor(n,e,s){this.route=n;this.forumService=e;this.authService=s}threadId;thread=null;posts=[];loading=!0;error=null;posting=!1;newPost={content:""};ngOnInit(){this.route.params.subscribe(n=>{this.threadId=+n.id,this.loadThreadData()})}loadThreadData(){this.loading=!0,this.error=null,import("./chunk-EUVWED6G.js").then(({forkJoin:n})=>{n({thread:this.forumService.getThread(this.threadId),posts:this.forumService.getThreadPosts(this.threadId)}).subscribe({next:({thread:e,posts:s})=>{this.thread=e,this.posts=s.content||[],this.loading=!1},error:e=>{this.error="Failed to load thread. Please try again later.",this.loading=!1,console.error("Error loading thread:",e)}})})}createPost(){this.newPost.content.trim()&&(this.posting=!0,this.forumService.createPost(this.threadId,{content:this.newPost.content}).subscribe({next:n=>{this.posts.push(n),this.newPost.content="",this.posting=!1},error:n=>{this.error="Failed to post reply. Please try again.",this.posting=!1,console.error("Error creating post:",n)}}))}formatDate(n){let e=new Date(n),d=Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60));return d<1?"Just now":d<24?`${d}h ago`:d<168?`${Math.floor(d/24)}d ago`:e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}getFormattedContent(n){return n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/^/,"<p>").replace(/$/,"</p>").replace(/<p><\/p>/g,"")}static \u0275fac=function(e){return new(e||i)(u(O),u(W),u(H))};static \u0275cmp=w({type:i,selectors:[["app-thread-view"]],decls:4,vars:3,consts:[["loadingTemplate",""],["postForm","ngForm"],["class","container mx-auto px-4 py-8",4,"ngIf","ngIfElse"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"container","mx-auto","px-4","py-8"],[1,"max-w-4xl","mx-auto"],[1,"mb-6"],[1,"flex","items-center","space-x-2","text-sm","text-gray-500"],["routerLink","/forums",1,"hover:text-minecraft-green"],[1,"text-gray-700"],["class","bg-white rounded-lg shadow-md p-6 mb-6 border border-gray-200",4,"ngIf"],[1,"space-y-4","mb-8"],["class","bg-white rounded-lg shadow-md border border-gray-200",4,"ngFor","ngForOf"],["class","bg-white rounded-lg shadow-md p-6 border border-gray-200",4,"ngIf"],["class","bg-gray-50 rounded-lg p-6 text-center border border-gray-200",4,"ngIf"],[1,"bg-white","rounded-lg","shadow-md","p-6","mb-6","border","border-gray-200"],[1,"text-3xl","font-bold","text-minecraft-green","mb-4"],[1,"flex","items-center","space-x-4","text-sm","text-gray-500"],[1,"flex","items-center","space-x-2"],[1,"w-8","h-8","rounded-full",3,"src","alt"],[1,"font-medium"],[1,"bg-white","rounded-lg","shadow-md","border","border-gray-200"],[1,"p-6"],[1,"flex","items-start","space-x-4"],[1,"w-10","h-10","rounded-full","flex-shrink-0",3,"src","alt"],[1,"flex-1"],[1,"flex","items-center","justify-between","mb-3"],[1,"flex","items-center","space-x-3"],[1,"font-medium","text-minecraft-dark"],[1,"text-sm","text-gray-500"],["class","bg-minecraft-green text-white text-xs px-2 py-1 rounded",4,"ngIf"],[1,"text-sm","text-gray-400"],[1,"prose","prose-sm","max-w-none"],[3,"innerHTML"],[1,"bg-minecraft-green","text-white","text-xs","px-2","py-1","rounded"],[1,"bg-white","rounded-lg","shadow-md","p-6","border","border-gray-200"],[1,"text-lg","font-semibold","text-minecraft-dark","mb-4"],[3,"ngSubmit"],[1,"mb-4"],["name","content","required","","rows","4","placeholder","Write your reply...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-minecraft-green","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"flex","justify-end"],["type","submit",1,"px-6","py-2","bg-minecraft-green","text-white","rounded","hover:bg-minecraft-dark","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","duration-200",3,"disabled"],[1,"bg-gray-50","rounded-lg","p-6","text-center","border","border-gray-200"],[1,"text-gray-600","mb-4"],["href","/api/oauth2/authorization/google",1,"inline-block","bg-minecraft-green","text-white","px-6","py-2","rounded","hover:bg-minecraft-dark","transition-colors","duration-200"],[1,"flex","justify-center","items-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-minecraft-green"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],[1,"text-red-600"]],template:function(e,s){if(e&1&&p(0,Q,16,5,"div",2)(1,X,2,0,"ng-template",null,0,P)(3,Z,5,1,"div",3),e&2){let d=_(2);l("ngIf",!s.loading)("ngIfElse",d),o(3),l("ngIf",s.error)}},dependencies:[V,F,M,A,D,U,$,k,N,R,z,j,L],styles:[".prose[_ngcontent-%COMP%]{color:#374151}.prose[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem}.prose[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#f3f4f6;padding:.125rem .25rem;border-radius:.25rem;font-size:.875em}.prose[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background-color:#1f2937;color:#f9fafb;padding:1rem;border-radius:.5rem;overflow-x:auto;margin:1rem 0}"]})};export{q as ThreadViewComponent};
